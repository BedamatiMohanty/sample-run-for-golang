\documentclass[10pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{fullpage}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{comment}
\usepackage{occi}
\setlength{\headheight}{13pt}
\pagestyle{fancy}

% default sans-serif
\renewcommand{\familydefault}{\sfdefault}

% no lines for headers and footers
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

% header
\fancyhf{}
\lhead{GWD-R}
\rhead{\today}

% footer
\lfoot{occi-wg@ogf.org}
\rfoot{\thepage}

% paragraphs need some space...
\setlength{\parindent}{0pt}
\setlength{\parskip}{1ex plus 0.5ex minus 0.2ex}

% some space between header and text...
\headsep 13pt

\setcounter{secnumdepth}{4}

\begin{document}

% header on first page is different
\thispagestyle{empty}

Draft \hfill Ralf Nyr√©n, Independent \\
OCCI-WG \hfill Andy Edmonds, Zhaw \\
\rightline {Thijs Metsch, Intel}
\rightline {February 4, 2013}\\
\rightline {Updated: \today}

\vspace*{0.5in}

\begin{Large}
\textbf{Open Cloud Computing Interface - RESTful HTTP Protocol}
\end{Large}

\vspace*{0.5in}

\underline{Status of this Document}

%\input{include/status}
This is a draft proposal of a new document in the Open Cloud Computing
Interface specification suite.

\underline{Copyright Notice}

Copyright \copyright Open Grid Forum (2013-2015). All Rights Reserved.

\underline{Trademarks}

OCCI is a trademark of the Open Grid Forum.

\underline{Abstract}

\input{include/abstract}


\newpage
\tableofcontents
\newpage

\section{Introduction}
%\input{include/introduction}

\section{Notational Conventions}
\input{include/notational}

The following terms \cite{rfc3986} are used when referring to URI
components:

\begin{verbatim}
 http://example.com:8080/over/there?action=stop#xyz
 \__/   \______________/\_________/ \_________/ \_/
  |           |            |            |        |
scheme     authority       path        query   fragment
\end{verbatim}

\section{OCCI RESTful HTTP Protocol}

This document specifies the OCCI HTTP Protocal, a RESTful protocol for
communication between OCCI Server and OCCI Client. The OCCI HTTP Protocol
support multiple different data formats as payload. Data formats are specified
an separate documents.

\section{Namespace}

The OCCI HTTP Protocol maps the OCCI Core model into the URL hierarchy by binding
\hl{Kind} and \hl{Mixin} instances to unique URL paths. Such a URL path is called
the {\em location} of the \hl{Kind} or \hl{Mixin}.
A provider is free to choose the {\em location} as long as it is unique
within the service provider's URL namespace.
For example, the \hl{Kind} instance%
\footnote{\tt http://schemas.ogf.org/occi/infrastructure\#compute}
for the \hl{Compute} type may be bound to {\tt /my/occi/api/compute/}.

A \hl{Kind} instance whose associated type cannot be instantiated MUST NOT be
bound to an URL path. This applies to the \hl{Kind} instance for OCCI Entity
which, according to OCCI Core, cannot be instantiated \cite{occi:core}.

\todo{sub resources here.}

\subsection{Bound and unbound paths}

Since a limited set of URL paths are bound to \hl{Kind} and \hl{Mixin}
instances the URL hierarchy consists of both {\em bound} and {\em unbound}
paths.
A bound URL path is the {\em location} of a \hl{Kind} or \hl{Mixin} collection.

An unbound URL path MAY represent the union of all \hl{Kind} and \hl{Mixin}
collection ``below'' the unbound path.
\todo{FIXME: Should this be a MUST instead?}

\section{Headers and status codes}

\todo{add all other HTTP niftyness from old spec here.}

OCCI Clients and Servers must include a minimum set of mandatory HTTP headers
in each request and response in order to be compliant.
There is also a minimum set of HTTP status codes which must be supported by
an implementation of the OCCI HTTP Protocol.

\subsection{Mandatory HTTP requests headers}

\begin{description}
\item[Accept] An OCCI Client SHOULD specify the media-types the OCCI data
formats it supports in the {\tt Accept} header.

\item[Content-type] If an OCCI Client submits payload in a HTTP request
the OCCI Client MUST specify the media-type of the OCCI data format
in the {\tt Content-type} header.
\end{description}

\subsection{Mandatory HTTP response headers}

\begin{description}
\item[Content-type] An OCCI Server MUST specify the media-type of the OCCI data
format used in a HTTP Response.
\item[Server] An OCCI Server MUST specify the OCCI HTTP Protocol version number.
\end{description}

\subsection{HTTP status codes}
The below list specifies the minimum set of HTTP status codes an OCCI Client MUST
understand. An OCCI Server MAY return other HTTP status codes but the exact client
behaviour in such cases is not specified. The return codes are specified by 
\cite{rfc7231} and \cite{rfc7235}.

\begin{description}
\item[200 OK] indicates that the request has succeeded.
\item[201 CREATED] indicates that the request has been fulfilled and has resulted in one or more new resources being created.
\item[400 Bad Request] indicates that the server cannot or will not process the request due to something that is perceived to be a client error
\item[401 Unauthorized] indicates that the request has not been applied because it lacks valid authentication credentials for the target resource.
\item[403 Forbidden] indicates that the server understood the request but refuses to authorize it.
\item[404 Not Found] indicates that the origin server did not find a current representation for the target resource or is not willing to disclose that one exists
\item[405 Method Not Allowed] indicates that the method received in the request-line is known by the origin server but not supported by the target resource.
\item[406 Not Acceptable] status code indicates that the target resource does not have a current representation that would be acceptable to the user agent
\item[413 Request Entity Too Large] status code indicates that the request is larger than the server is willing or able to process.
\item[500 Internal Server Error] indicates that the server encountered an unexpected condition that prevented it from fulfilling the request.
\item[501 Not Implemented] indicates that the server does not support the functionality required to fulfill the request.
\end{description}

\section{Filters}

TODO: define filters
remove filters later one.

\section{Pagination}

To request partial results of an otherwise large collection message response, pagination SHOULD be used to reduce the load on 
both the client and the service provider. This is done in the following manner.

The HTTP verb GET is used against a URI to a collection and the query parameters of {\em page} and {\em number} MUST be used. {\em page} is a indexed 
integer that refers to a sub-collection of the requested collection. {\em number} is an integer of items that SHOULD be displayed in one paged response.

% e.g. GET http://host/path/to/collection?page=1;number=100

If {\em number} is too large for the provider to handle (policy, technical) then a HTTP 413 response status code MUST be issued to the requesting client.

If there is no more content to be served the result should be a HTTP 200 response status code MUST be issued to the requesting client.


\section{HTTP methods applied to entity instance URLs}

\todo{Sanity check this section against v1.1...}

This section describes the HTTP methods used to retrieve and manipulate
individual entity instances. An {\em entity instance} refers to an instance
of the OCCI \hl{Resource} type, OCCI \hl{Link} type or a sub-type thereof
\cite{occi:core}.

Each HTTP method described is assumed to operate
on an URL referring to a single element in a collection, an URL such as the
following:
\begin{verbatim}
  http://example.com/compute/012d2b48-c334-47f2-9368-557e75249042
\end{verbatim}

\subsection{GET entity instance}
The HTTP GET method retrieves a representation of a single (existing) entity instance.

\paragraph{Client GET request}
N/A

\paragraph{Server GET response}
The message of the HTTP GET response MUST contain a representation of the entity instance.

Upon a successfully request a \emph{200 Ok} status code MUST be used.

\subsection{PUT entity instance}
The HTTP PUT method either {\em creates} a new or {\em replaces} an existing entity instance at the specified URL.

\subsubsection{create}

\paragraph{PUT request}
The message MUST contain the full representaiton of a entity instance.

\paragraph{Server PUT reponse}
The OCCI implementation MAY either return 201 or 200 HTTP return codes. If the OCCI implementation
returns the \emph{200 OK} HTTP response code the full representation of an entity instance MUST be returned. 
In case of a \emph{201 CREATED} HTTP response code is the HTTP Location header as defined in RFC7231 \cite{rfc7231} MUST be used.

\subsubsection{replace}

\paragraph{Client PUT request}
The message must contain the full representaiton of a entity instance.

\paragraph{Server PUT reponse}
The OCCI implementation MAY either return 201 or 200 HTTP return codes. If the OCCI implementation
returns the \\emph{200 OK} HTTP response code the full representation of an entity instance MUST be returned. 
In case of a \emph{201 CREATED} HTTP response code is MUST the HTTP Location header as defined in RFC7231 \cite{rfc7231}.

Any OCCI \hl{Link}s associated with an existing OCCI \hl{Resource} MUST be left intact.

\subsection{POST entity instance}
The HTTP POST method either {\em partially updates} or triggers and {\em actions} on an existing entity instance.

\subsubsection{partial update}

\paragraph{POST request}
The message MUST contain a partial representation of a entity instance to be changed.

\paragraph{Server POST reponse}
The OCCI implementation MAY either return 201 or 200 HTTP return codes. If the OCCI implementation
returns the \\emph{200 OK} HTTP response code the full representation of an entity instance MUST be returned. 
In case of a \emph{201 CREATED} HTTP response code is MUST the HTTP Location header as defined in RFC7231 \cite{rfc7231}.

\subsubsection{action}
Actions are triggered using the HTTP POST verb and by adding a query to the URI. This query MUST contain a key-value pair. The key MUST be "action". The value MUST equal to the \hl{Action}'s term.

\paragraph{POST request}
The message MUST contain the unique identifier of the \hl{Action} instance. It MAY contain attributes associated with the triggered \hl{Action}.

\paragraph{Server POST reponse}
The message of the HTTP GET response MUST contain a representation of the entity instance.

Upon a successfully request a \emph{200 OK} status code MUST be used.

\subsection{DELETE entity instance}
The HTTP DELETE method delete an entity instance

\paragraph{Client DELETE request}
N/A

\paragraph{Server DELETE response}
Upon a successfully request a \emph{200 OK} status code MUST be used.

\section{HTTP methods applied to collections URLs}

\subsection{GET collection}
The HTTP GET method retrieves a representation of the collection of a set of existing entity instance.

\paragraph{Client GET request}
MAY include a possible filter representation.

\paragraph{Server GET response}
The reponse MUST include a representation of a collection.

Upon a successfully request a \emph{200 OK} status code MUST be used.

\subsection{PUT collection}
The HTTP PUT is only defined for a collection defined by a \hl{Mixin}. It will will allow for replacing a collection.

\paragraph{Client PUT request}
MUST include a full representation of the collection.

\paragraph{Server PUT response}
The reponse MUST include a representation of a collection.

Upon a successfully request a \emph{200 OK} status code MUST be used.

\subsection{POST collection}
The HTTP POST method is defined for {\em creation} of entity instance, {\em association} of entity instance with a \hl{Mixin} and triggering {\em actions}.

\subsubsection{create}

\paragraph{Client POST request}
MUST include at least one full entity representation. It MAY include mutliple full entity representations.

\paragraph{Server POST response}
In case server replies with \emph{200 OK} HTTP status code it MUST include either arepresentation of collection or single entitiy representation. In case a \emph{201 CREATED} HTTP status code a URI to a entity instance or a list of entity instance URIs MUST be returned.

\subsubsection{associate}
This operation MUST only be available for collections defined by a \hl{Mixin}

\paragraph{Client POST request}
The request MUST include one or more URIs for the entity instance which require the \hl{Mixin} to be applied.

\paragraph{Server POST response}
On successfull operation the server replies with the \emph{200 OK} HTTP status code it MUST include either a representation of collection or single entity representation. 

\subsubsection{action}
Actions are triggered using the HTTP POST verb and by adding a query to the URI. This query MUST contain a key-value pair. The key MUST be "action". The value MUST equal to the \hl{Action}'s term.

\paragraph{Client POST request}
The message MUST contain the unique identifier of the \hl{Action} instance. It MAY contain attributes associated with the triggered \hl{Action}.

\paragraph{Server POST reponse}
The message of the HTTP GET response MUST contain a full representation of the collection representation.

Upon a successfully request a \emph{200 OK} status code MUST be used.

\subsection{DELETE collection}
The HTTP delete method is used to either {\em delete} all entity instances in a collection or {\em diassociate} entity instance from a collection defined by a \hl{Mixin}.

\subsubsection{delete}

\paragraph{Client DELETE request}
NA

\paragraph{Server DELETE reponse}
Upon a successfully request a \emph{200 OK} status code MUST be used.

\subsubsection{disassociate}
This operation MUST only be available for collections defined by a \hl{Mixin}

\paragraph{Client DELETE request}
The request MAY include one or more URIs for the entity instance which requires the \hl{Mixin} to be disassociated.

\paragraph{Server DELETE reponse}
Upon a successfully request a \emph{200 OK} status code MUST be used.

\section{HTTP methods applied to QI}

\subsection{GET on query interface}

\paragraph{Client GET request}
MAY include a possible filter representation.

\paragraph{Server GET response}
The reponse MUST include a representation of a collection.

Upon a successfully request a \emph{200 OK} status code MUST be used.

\subsection{PUT on query interface}

This HTTP method is not defined.

\subsection{POST on query interface}

\paragraph{Client POST request}
MUST include at least one full category representation. It MAY include mutliple full category representations.

\paragraph{Server POST response}
Upon a successfully request a \emph{200 OK} status code MUST be used.

\subsection{DELETE on query interface}

\paragraph{Client DELETE request}
MUST include at least one full category representation. It MAY include mutliple full category representations.

\paragraph{Server DELETE response}
Upon a successfully request a \emph{200 OK} status code MUST be used.

\section{Glossary}
\label{sec:glossary}
\input{include/glossary}

%\section{Contributors}
%\include{include/contributors}
% FIXME: Insert an up-to-date table here!

\section{Intellectual Property Statement}
\input{include/ip}

\section{Disclaimer}
\input{include/disclaimer}

\section{Full Copyright Notice}
\input{include/copyright}

\bibliographystyle{IEEEtran}
\bibliography{references}

\end{document}
