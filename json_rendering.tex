\documentclass[10pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{fullpage}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{comment}
\usepackage{occi}
\usepackage{lineno} % adds line numbers, may be removed for non draft versions
\linenumbers        % adds line numbers, may be removed for non draft versions
\usepackage{minted} % code highlighting
\setlength{\headheight}{13pt}
\pagestyle{fancy}

% default sans-serif
\renewcommand{\familydefault}{\sfdefault}

% no lines for headers and footers
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}

% header
\fancyhf{}
\lhead{GWD-R}
\rhead{\today}

% footer
\lfoot{occi-wg@ogf.org}
\rfoot{\thepage}

% paragraphs need some space...
\setlength{\parindent}{0pt}
\setlength{\parskip}{1ex plus 0.5ex minus 0.2ex}

% some space between header and text...
\headsep 13pt

\setcounter{secnumdepth}{4}

\begin{document}

% header on first page is different
\thispagestyle{empty}

GWD-R \hfill Ralf Nyr√©n \\
OCCI-WG \hfill Florian Feldhaus, GWDG\\
\rightline {February 25, 2011}\\
\rightline {Updated: \today}

\vspace*{0.5in}

\begin{Large}
\textbf{Open Cloud Computing Interface - JSON Rendering}
\end{Large}

\vspace*{0.5in}

\underline{Status of this Document}

This document provides information to the community regarding the
specification of the Open Cloud Computing Interface. Distribution is
unlimited.

\underline{Copyright Notice}

Copyright \copyright Open Grid Forum (2012). All Rights Reserved.

\underline{Trademarks}

OCCI is a trademark of the Open Grid Forum.

\underline{Abstract}

This document, part of a document series, produced by the OCCI working
group within the Open Grid Forum (OGF), provides a high-level
definition of a Protocol and API. The document is based upon
previously gathered requirements and focuses on the scope of important
capabilities required to support modern service offerings.

\underline{Comments}
\newcommand{\ralf}[1]{\textcolor{red}{RN: #1}}
\newcommand{\andy}[1]{\textcolor{green}{AE: #1}}

\newpage
\tableofcontents
\newpage

\section{Introduction}
%\input{include/introduction}

\section{Notational Conventions}
\input{include/notational}

\section{OCCI JSON Rendering}
{\em TBD: intro, JSON Rendering is RESTful, can happily co-exist with the
existing HTTP Rendering, etc}

\section{Namespace}

The JSON Rendering provides a rendering (i.e. serialisation) of the OCCI 
Core model into the URL hierarchy by binding
\hl{Kind} and \hl{Mixin} instances to unique URL paths. Such a URL path is called
the {\em location} of the \hl{Kind} or \hl{Mixin}.
A provider is free to choose the {\em location} as long as it is unique
within the service provider's URL namespace.
For example, the \hl{Kind} instance%
\footnote{\tt http://schemas.ogf.org/occi/infrastructure\#compute}
for the \hl{Compute} type may be bound to {\tt /my/occi/api/compute/}.

A \hl{Kind} instance whose associated type cannot be instantiated MUST NOT be
bound to an URL path. This applies to the \hl{Kind} instance for OCCI Entity.

\subsection{Bound and Unbound Paths}

Since a limited set of URL paths are bound to \hl{Kind} and \hl{Mixin}
instances the URL hierarchy consists of both {\em bound} and {\em unbound}
paths.
A bound URL path is the {\em location} of a \hl{Kind} or \hl{Mixin} collection.

An unbound URL path MAY represent the union of all \hl{Kind} and \hl{Mixin}
collection ``below'' the unbound path.
\ralf{FIXME: Should this be a MUST instead?}
\andy{Q: Do these apply for instances also?}

\section{JSON Format}
\label{sec:json_format}
The OCCI JSON Rendering consists of a JSON object holding information on the 
OCCI core objects kind, mixin, action, link and resource.

The following media-type has been assigned to the OCCI JSON Rendering:

{\tt application/occi+json}

\subsection{Resource Instance Format}
\label{sec:format_resource}

A {\em resource instance} is a sub-type of OCCI Entity which has been instantiated.
OCCI Resource and OCCI Link are the top-most sub-types of OCCI Entity.
OCCI Entity itself cannot be instantiated.

The resource instance format consists of a JSON object as shown in the
following example. Section \ref{sec:example_resource} contains a detailed example.
Table~\ref{tbl:format_resource} defines the object members.
\begin{minted}{json}
{
    "resources": [
        {
            "kind": "...",
            "mixins": [ "...", "..." ],
            "attributes": { },
            "actions": [ { }, { } ],
            "id": "...",
            "title": "...",
            "summary": "...",
            "links": [ { }, { } ],
        }
    ]
}
\end{minted}
\mytablefloat{
    \label{tbl:format_resource}
    Resource instances are rendered using the
    {\tt application/occi+json} format which consists of a JSON object with name {\em resources}
    containing an array of JSON objects with the following entries.
    } {
    \begin{tabular}{llp{5.0cm}p{3.0cm}}
    \toprule
    Object member & JSON type & Description & Necessity \\
    \colrule
    kind & string & Kind identifier & Mandatory \\

    mixins & array of strings & List of Mixin identifiers &
    Mandatory if resource has mixins \\

    attributes & object & Instance attributes & Mandatory if resource has attributes \\

    actions & array of objects & Actions applicable to the resource instance as defined in~\ref{tbl:format_action} &
    Mandatory if resource has applicable actions \\
    
    id & string & UUID of the resource & Mandatory\\
        
    title & string & Title of the resource & Optional\\
    
    summary & string & Summary describing the resource & Optional\\
    
    links & array of objects & Associated OCCI Links as defined in~\ref{tbl:format_link} &
    Mandatory if resource has links\\
    \botrule
    \end{tabular}
}
\subsection{Link Instance Format}
\label{sec:format_link}

The link instance format consists of a JSON object as shown in the
following example. Section \ref{sec:example_link} contains a detailed example.
Table~\ref{tbl:format_link} defines the object members.
\begin{minted}{json}
{
    "links": [
        {
            "kind": "...",
            "mixins": [ "...", "..." ],
            "attributes": { },
            "actions": [ { }, { } ],
            "id": "...",
            "title": "...",
            "target": "...",
            "source": "..."
        }
    ]
}
\end{minted}
\mytablefloat{
    \label{tbl:format_link}
    Link instances are rendered using the
    {\tt application/occi+json} format which consists of a JSON object with name {\em links}
    containing an array of JSON objects with the following entries.
    } {
    \begin{tabular}{llp{5.0cm}p{3.0cm}}
    \toprule
    Object member & JSON type & Description & Necessity \\
    \colrule
    kind & string & Kind identifier & Mandatory \\

    mixins & array of strings & List of Mixin identifiers &
    Mandatory if resource has mixins \\

    attributes & object & Instance attributes & Mandatory if resource has attributes \\

    actions & array of objects & Actions applicable to the resource instance as defined in~\ref{tbl:format_action} &
    Mandatory if resource has applicable actions \\
    
    id & string & UUID of the link & Mandatory\\
        
    title & string & Title of the link & Optional\\
        
    target & string & Absolute location of target resource & Mandatory \\
    
    source & string & Absolute location of source resource & Mandatory unless rendered within the source resource\\
    \botrule
    \end{tabular}
}

\subsection{Kind Format}
\label{sec:format_kind}

An OCCI kind is used to describe a OCCI entity and cannot itself be 
instantiated. OCCI kinds can only be queried through the query interface 
of an OCCI server to get a complete description of a specific OCCI entity sub-type.

The kind format consists of a JSON object as shown in the
following example. Section \ref{sec:example_kind} contains a detailed example.
Table~\ref{tbl:format_kind} defines the top-level object members.

\mytablefloat{
    \label{tbl:format_kind}
    Kinds are rendered using the
    {\tt application/occi+json} format which consists of a JSON object with name {\em kinds}
    containing an array of JSON objects with the following entries.
    } {
    \begin{tabular}{llll}
    \toprule
    Object member & JSON type & Description & Necessity\\
    \colrule
    term & string & Unique identifier within the categorisation scheme & Mandatory\\
    scheme & string & Categorisation scheme & Mandatory\\
    title & string & Title of the kind & Mandatory\\
    attributes & object & Attribute description, see ~\ref{tbl:format_attribute} & Mandatory if kind has attributes\\
    related & array of strings & List containing the related ``parent'' \hl{Kind} instance & Mandatory if kind is related to another kind\\
    actions & array of strings & List of action identifiers & Mandatory if kind has actions\\
    location & string & Relative URL bound to the \hl{Kind} instance & Mandatory\\
    \botrule
    \end{tabular}
}

\begin{minted}{json}
{
    "kinds": [
        {
            "term": "...",
            "scheme": "...",
            "title": "...",
            "attributes": { },
            "actions": [ "...", "..." ],
            "related": [ "...", "..." ],
            "location": "..."
        }
    ]
}
\end{minted}

\subsection{Mixin Format}
\label{sec:format_mixin}

An OCCI mixin can be used to extend OCCI entities and cannot itself be 
instantiated. OCCI mixins can be queried through the query interface 
of an OCCI server and also be created by a user, where permitted.

The mixin format consists of a JSON object as shown in the
following example. Section \ref{sec:example_kind} contains a detailed example.
Table~\ref{tbl:format_mixin} defines the top-level object members.

\mytablefloat{
    \label{tbl:format_mixin}
    Mixins are rendered using the
    {\tt application/occi+json} format which consists of a JSON object with name {\em mixins}
    containing an array of JSON objects with the following entries.
    } {
    \begin{tabular}{llll}
    \toprule
    Object member & JSON type & Description & Necessity\\
    \colrule
    term & string & Unique identifier within the categorisation scheme & Mandatory\\
    scheme & string & Categorisation scheme & Mandatory\\
    title & string & Title of the mixin & Mandatory\\
    attributes & object & Attribute description, see ~\ref{tbl:format_attribute} & Mandatory if mixin has attributes\\
    related & array of strings & List containing the related ``parent'' \hl{Mixin} instance & Mandatory if mixin is related to other mixins\\
    actions & array of strings & List of action identifiers & Mandatory if mixin has actions\\
    location & string & Relative URL bound to the \hl{Kind} instance & Mandatory\\
    \botrule
    \end{tabular}
}

\begin{minted}{json}
{
    "mixins": [
        {
            "term": "...",
            "scheme": "...",
            "title": "...",
            "attributes": { },
            "actions": [ "...", "..." ],
            "related": [ "...", "..." ],
            "location": "..."
        }
    ]
}
\end{minted}

\subsection{Action Format}
\label{sec:format_action}

An OCCI action can be used to trigger specific actions on an OCCI entity and cannot itself be 
instantiated. OCCI actions can only be queried through the query interface 
of an OCCI server.

The action format consists of a JSON object as shown in the
following example.
Table~\ref{tbl:format_action} defines the top-level object members.

\mytablefloat{
    \label{tbl:format_action}
    Actions are rendered using the
    {\tt application/occi+json} format which consists of a JSON object with name {\em actions}
    containing an array of JSON objects with the following entries.
    } {
    \begin{tabular}{llll}
    \toprule
    Object member & JSON type & Description & Necessity\\
    \colrule
    term & string & Unique identifier within the categorisation scheme & Mandatory\\
    scheme & string & Categorisation scheme & Mandatory\\
    title & string & Title of the mixin & Optional\\
    attributes & object & Attribute description, see ~\ref{tbl:format_attribute} & Mandatory if action has attributes\\
    \botrule
    \end{tabular}
}

\begin{minted}{json}
{
    "actions": [
        {
            "term": "...",
            "scheme": "...",
            "title": "...",
            "attributes": { }
        }
	]
}
\end{minted}

\subsection{Attribute Description Format}
\label{sec:format_attribute_description}

Attribute descriptions of OCCI Categories are rendered as JSON objects. 
The dots of the attribute names define a hierarchy. This hierarchy is reflected 
by JSON objects within the higher layer JSON object or within the top level 
JSON object with name {\em attributes}. The last part of the attribute name
 hierarchy includes the properties-object pairs of the attribute as defined 
 in table~\ref{tbl:format_attribute_description}

\mytablefloat{
    \label{tbl:format_attribute_description}
    The attribute-properties object has the members defined in this table.
    %
    All attribute properties are optional and the table shows which property default value
    an OCCI client MUST assume if a particular property is unspecified.
    } {
    \begin{tabular}{llll}
    \toprule
    Object member & JSON type & Description & Default \\
    \colrule
    mutable & boolean & Attribute mutability & true \\
    required & boolean & Whether the attribute MUST be specified at resource instantiation & false \\
    type & string & Enum \{string, number, boolean\}
    & string \\
    pattern & string & Posix Extended Regular Expression as defined in \cite{iso9945:2009}. For interoperability reasons, POSIX character classes like e.g. [:alpha:] should not be used. & .* \\
    minimum & number & If type is a number, then minimum defines the lowest number allowed. If type is a string, then minimum defines the minimal length of the string. \\
    maximum & If type is a number, then maximum defines the highest number allowed. If type is a string, then maximum defines the maximal length of the string.\\
    default & string, number or boolean & Attribute default when not specified by client. & null \\
    \botrule
    \end{tabular}
}
\begin{minted}{json}
{
    "attributes": {
        "...": {
            "mutable": true,
            "required": false,
            "type": "string",
            "pattern": ".*",
            "minimum": 1,
            "maximum": 65535,
            "default": null
        }
    }
}
\end{minted}

\section{Detailed Examples}
\label{sec:examples}

\subsection{Resource Instance Format Example}
\label{sec:example_resource}

\begin{minted}{json}
{
    "resources": [
        {
            "kind": "http: //schemas.ogf.org/occi/infrastructure#compute",
            "mixins": [
                "http: //schemas.opennebula.org/occi/infrastructure#my_mixin",
                "http: //schemas.other.org/occi#my_mixin"
            ],
            "attributes": {
                "occi": {
                    "compute": {
                        "speed": 2,
                        "memory": 4,
                        "cores": 2
                    }
                },
                "org": {
                    "other": {
                        "occi": {
                            "my_mixin": {
                                "my_attribute": "my_value"
                            }
                        }
                    }
                }
            },
            "actions": [
                {
                    "title": "Start My Server",
                    "href": "/compute/996ad860-2a9a-504f-8861-aeafd0b2ae29?action=start",
                    "category": "http://schemas.ogf.org/occi/infrastructure/compute/action#start"
                }
            ],
            	"id": "996ad860-2a9a-504f-8861-aeafd0b2ae29",
		    "title": "Compute resource",
		    "summary": "This is a compute resource",
		    "links": [
		        {
		            "target": "http://myservice.tld/storage/59e06cf8-f390-5093-af2e-3685be593a25",
		            "kind": "http://schemas.ogf.org/occi/infrastructure#storagelink",
		            "attributes": {
		                "occi": {
		                    "storagelink": {
		                        "deviceid": "ide:0:1"
		                    }
		                }
		            },
		            "id": "391ada15-580c-5baa-b16f-eeb35d9b1122",
		            "title": "My disk"
		        }
		    ]
        }
    ]
}
\end{minted}

\subsection{Link Instance Format Example}
\label{sec:example_link}

\begin{minted}{json}
{
    "links": [
        {
            "kind": "http://schemas.ogf.org/occi/infrastructure#networkinterface",
            "mixins": [
                "http://schemas.ogf.org/occi/infrastructure/networkinterface#ipnetworkinterface"
            ],
            "attributes": {
                "occi": {
                    "infrastructure": {
                        "networkinterface": {
                            "interface": "eth0",
                            "mac": "00:80:41:ae:fd:7e",
                            "address": "192.168.0.100",
                            "gateway": "192.168.0.1",
                            "allocation": "dynamic"
                        }
                    }
                }
            },
            "actions": [
                {
                    "title": "Disable networkinterface",
                    "href": "/networkinterface/22fe83ae-a20f-54fc-b436-cec85c94c5e8?action=up",
                    "category": "http: //schemas.ogf.org/occi/infrastructure/networkinterface/action#up"
                }
            ],
            "id": "22fe83ae-a20f-54fc-b436-cec85c94c5e8",
		    "title": "My network interface",
            "target": "http://myservice.tld/network/b7d55bf4-7057-5113-85c8-141871bf7635",
            "source": "http://myservice.tld/compute/996ad860-2a9a-504f-8861-aeafd0b2ae29"
        }
    ]
}
\end{minted}

\subsection{Kind Format Example}
\label{sec:example_kind}

\begin{minted}{json}
{
    "kinds": [
        {
            "term": "compute",
            "scheme": "http://schemas.ogf.org/occi/infrastructure#",
            "title": "Compute Resource",
            "related": [
                "http://schemas.ogf.org/occi/core#resource"
            ],
            "attributes": {
                "occi": {
                    "compute": {
                        "hostname": {
                            "mutable": true,
                            "required": false,
                            "type": "string",
                            "pattern": "(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\-]*[a-zA-Z0-9])\\.)*",
                            "minimum": "1",
                            "maximum": "255"
                        },
                        "state": {
                            "mutable": false,
                            "required": false,
                            "type": "string",
                            "pattern": "inactive|active|suspended|failed",
                            "default": "inactive"
                        }
                    }
                }
            },
            "actions": [
                "http://schemas.ogf.org/occi/infrastructure/compute/action#start",
                "http://schemas.ogf.org/occi/infrastructure/compute/action#stop",
                "http://schemas.ogf.org/occi/infrastructure/compute/action#restart",
                "http://schemas.ogf.org/occi/infrastructure/compute/action#suspend"
            ],
            "location": "/compute/"
        }
    ]
}
\end{minted}

\subsection{Mixin Format Example}
\label{sec:example_mixin}

\begin{minted}{json}
{
    "mixins": [
        {
            "term": "medium",
            "scheme": "http://example.com/template/resource#",
            "title": "Medium VM",
            "related": [
                "http://schemas.ogf.org/occi/infrastructure#resource_tpl"
            ],
            "attributes": {
                "occi": {
                    "compute": {
                        "speed": {
                            "type": "number",
                            "default": 2.8
                        }
                    }
                }
            },
            "location": "/template/resource/medium/"
        }
    ]
}
\end{minted}

\subsection{Action Format Example}
\label{sec:example_action}

\begin{minted}{json}
{
    "actions": [
        {
            "term": "stop",
            "scheme": "http://schemas.ogf.org/occi/infrastructure/compute/action#",
            "title": "Stop Compute instance",
            "attributes": {
                "method": {
                    "mutable": true,
                    "required": false,
                    "type": "string",
                    "pattern": "graceful|acpioff|poweroff",
                    "default": "poweroff"
                }
            }
        }
    ]
}
\end{minted}

\section{Glossary}
\label{sec:glossary}
\input{include/glossary}

%\section{Contributors}
%\include{include/contributors}
% FIXME: Insert an up-to-date table here!

\section{Intellectual Property Statement}
\input{include/ip}

\section{Disclaimer}
\input{include/disclaimer}

\section{Full Copyright Notice}
\input{include/copyright}

\bibliographystyle{IEEEtran}
\bibliography{references}

\end{document}
